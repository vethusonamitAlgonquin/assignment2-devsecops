# **Assignment 2: Automating Anomaly Detection and Alerting in Cloud Security**

Group Members:

Brent Encarnado - 040902865

Vethuson Amit - 04119985

Muna Adan - 040843043

Abdelrahman Mostafa - 041078120

## Part 1
Anomaly detection in security log analysis is a critical technique used to identify unusual patterns or behaviors that deviate from the norm, potentially indicating security incidents, such as cyber attacks, system failures, or unauthorized access. These techniques leverage data analytics, machine learning, and statistical methods to monitor, detect, and respond to anomalies in vast and complex data sets generated by IT systems and applications. This brief report highlights some of the most effective anomaly detection techniques applicable to security log analysis: 

### 1. Statistical Methods 

Statistical anomaly detection involves establishing a baseline of what is considered normal behavior and then identifying deviations from this baseline. Methods such as mean, median, mode analysis, and standard deviation are used for establishing the norm. For example, z-scores can help in identifying data points that are far from the mean. These methods are straightforward and effective for datasets with predictable and stable patterns. 

### 2. Machine Learning-Based Techniques 

Supervised Learning: Requires labeled data (normal and anomalous) to train models that can classify new data as either normal or anomalous. Techniques include Support Vector Machines (SVM), Neural Networks, and Decision Trees. 

Unsupervised Learning: Useful when you don't have labeled data. Algorithms try to understand the underlying structure of the data and identify outliers. Clustering algorithms like K-means or DBSCAN are commonly used, along with Autoencoders in deep learning that learn to reconstruct normal data and thus can detect anomalies by the reconstruction error. 

Semi-supervised Learning: Involves training on a small set of labeled data and a large set of unlabeled data. It is effective when acquiring labels is expensive or time-consuming.

### 3. Deep Learning Techniques 

Deep learning models, such as Convolutional Neural Networks (CNNs) and Recurrent Neural Networks (RNNs), are particularly effective in identifying complex patterns in data. For example, Long Short-Term Memory (LSTM) networks, a type of RNN, are well-suited for analyzing sequential log data, capturing long-term dependencies, and identifying anomalies. 

### 4. Hybrid Models 

Hybrid models combine multiple techniques to leverage their respective strengths. For instance, integrating machine learning models with rule-based systems can improve detection rates and reduce false positives. Hybrid approaches can be tailored to the specific characteristics of the log data and the security requirements of the organization. 

### Implementation Considerations 

Data Preprocessing: Involves cleaning and transforming log data into a suitable format for analysis. Techniques include tokenization, normalization, and feature extraction. 

Real-time Processing: Many security applications require real-time or near-real-time anomaly detection to promptly respond to potential threats. 

Scalability: The ability to efficiently process and analyze large volumes of log data is crucial for effective anomaly detection. 

 

Anomaly detection in security log analysis is a multifaceted field that incorporates various techniques ranging from statistical methods to advanced machine learning and deep learning approaches. The choice of technique depends on the nature of the log data, the availability of labeled data, and the specific security objectives of the organization. Continuous refinement and adaptation of these techniques are necessary to keep pace with evolving cyber threats and the increasing complexity of IT environments. 


## Part 2: Preparing for Automation 

Create Azure Logic App/ Setup 

![image](https://github.com/vethusonamitAlgonquin/assignment2-devsecops/assets/44175005/314a9c14-5d2f-4ca7-ba2c-854ebcb2d4f3)

![image](https://github.com/vethusonamitAlgonquin/assignment2-devsecops/assets/44175005/19fd7f17-59c6-47cc-a88e-032038701216)
Storage account created.

![image](https://github.com/vethusonamitAlgonquin/assignment2-devsecops/assets/44175005/16679433-2347-487d-82e1-3fcd8c7d20b4)

![image](https://github.com/vethusonamitAlgonquin/assignment2-devsecops/assets/44175005/0de614c7-3433-43c7-97a4-a58a73880e98)

Create a workflow to then be able to create triggers within designer.
![image](https://github.com/vethusonamitAlgonquin/assignment2-devsecops/assets/44175005/47823f92-d53c-419c-af7a-f7ae7acee768)

![image](https://github.com/vethusonamitAlgonquin/assignment2-devsecops/assets/44175005/42e9eb3b-a3ac-40d5-aa2c-f78882ef08a1)

![image](https://github.com/vethusonamitAlgonquin/assignment2-devsecops/assets/44175005/b887bf10-d73e-4515-b24c-92547b54d4e8)

Connect to Azure Log Analytics: Use the Azure Automation runbook or Logic App to connect to the Azure Log Analytics workspace set up in Assignment 1.
![image](https://github.com/vethusonamitAlgonquin/assignment2-devsecops/assets/44175005/5f4fc5a3-63c9-47d2-80f4-bc742455f2e1)

![image](https://github.com/vethusonamitAlgonquin/assignment2-devsecops/assets/44175005/22128b4e-93e1-4bca-8761-a3af65913540)

## Part 3: Implementing Anomaly Detection
In our system logs, if occurrences of "Login Failed" exceed 10 instances within the previous hour, it will be flagged as an anomaly. The application from the initial assignment has been adjusted to ensure a more consistent logging of "Login Failed" events.
The system undergoes a check every 30 minutes, a frequency we can adjust based on your preference. Upon triggering, an Azure monitor log action executes a query. Specifically, this query tallies the occurrences of Failed Logins within the preceding hour. Subsequently, the workflow examines whether this count surpasses 10. If it does, the system proceeds to execute another query retrieving details about the most recent Failed Login, subsequently dispatching this information to the administrator via the Outlook email connector.

A Schedule Trigger for every 30 minutes:
![image](https://github.com/vethusonamitAlgonquin/assignment2-devsecops/assets/44175005/0a283adb-1d86-4b10-a96e-8869c8b0d9af)

Run a query to check the number of Login Failed Within the last hour:
![image](https://github.com/vethusonamitAlgonquin/assignment2-devsecops/assets/44175005/c69bd1c0-a6cc-4c90-889b-4e9dbf1b6e6e)

Have a For loop for each item returned from the query:
![image](https://github.com/vethusonamitAlgonquin/assignment2-devsecops/assets/44175005/05ef5adc-0748-4cfd-9758-e3362cd26baa)

A conditional check with the amount of Login Failed is more than 10 in the past hour:
![image](https://github.com/vethusonamitAlgonquin/assignment2-devsecops/assets/44175005/a681418b-7e2b-490b-a359-4154067802ae)

Run Query to get syslog information of the latest Login Failed:
![image](https://github.com/vethusonamitAlgonquin/assignment2-devsecops/assets/44175005/7ecdd9d4-9ba1-4640-b856-a74f429b2b28)

Loop through each item returned from the Query:
![image](https://github.com/vethusonamitAlgonquin/assignment2-devsecops/assets/44175005/c0d91f49-e10b-4e92-82b0-f35a71b1f7a0)

Automated Email Sending Details of the Security log Anomaly:
![image](https://github.com/vethusonamitAlgonquin/assignment2-devsecops/assets/44175005/362a9a9f-1065-4094-bf75-b71192b04552)

Logic App Workflow Overview:
![image](https://github.com/vethusonamitAlgonquin/assignment2-devsecops/assets/44175005/f34aa560-e6af-49d7-bbd0-96a259cb59e8)


## Part 4:

### Regular Updates

To maintain the continuous effectiveness and relevance of the anomaly detection system in identifying emerging threats, it's crucial to regularly update the detection rules and algorithms. This entails establishing a routine, such as monthly or quarterly reviews, to revise and enhance detection rules based on new threat intelligence and insights gleaned from recent security incidents. An integral part of this process involves the automatic integration of real-time threat intelligence feeds, ensuring that detection rules are continually updated with the latest threat vectors and indicators of compromise. Furthermore, the implementation of machine learning algorithms that adapt over time is essential. These algorithms learn from the outcomes of detections, including false positives and negatives, to incrementally improve detection accuracy. To facilitate these updates, a rigorous change management protocol is necessary. This protocol ensures that each update undergoes thorough testing in a staging environment before its deployment to the production environment, thereby safeguarding the system's integrity and efficacy.

## Part 5: 

### Best Practices Explanation:

#### Proactive Monitoring and Anomaly Detection 
Utilize Azure Logic Apps to conduct real-time monitoring and employ anomaly detection rules, such as flagging multiple failed login attempts within a brief period, to identify potential security incidents swiftly.
#### Automated Incident Response 
Implement automated responses, such as email notifications, when anomalies are detected, ensuring immediate action can be taken to investigate and mitigate potential threats.
#### Principle of Least Privilege
Ensure that the Azure Logic App operates under the principle of least privilege, with access rights strictly limited to what is necessary for performing its designated tasks, thereby minimizing the risk of unauthorized access and actions.
#### Continuous Improvement
Engage in an ongoing process of refining and enhancing detection mechanisms and response strategies based on evolving threats and lessons learned from past incidents.



### Incident Response Plan

#### 1. Alert Detection and Notification 
Trigger an immediate alert and notification process when potential security incidents, such as multiple failed login attempts, are detected by the anomaly detection system.
#### 2. Initial Assessment
Conduct a preliminary assessment of the alert to verify its legitimacy and assess its severity, differentiating between false alarms and genuine security concerns.
#### 3. Incident Investigation
Initiate a thorough investigation to determine the cause and scope of the incident, utilizing forensic analysis to gather detailed information and identify the breach's source.
#### 4. Containment and Mitigation
Implement containment measures to prevent further unauthorized access or data compromise, followed by actions to mitigate the incident's impact, such as resetting compromised credentials and applying necessary patches.
#### 5. Recovery and Restoration
Facilitate the recovery process to restore affected systems and services to their normal operational state, ensuring all vulnerabilities are addressed.
#### 6. Post-Incident Review
After an incident is resolved, review the event and the response to it thoroughly. Identify what was learned, focusing on how the incident was detected and managed. By examining both the strengths and weaknesses of the response, the goal is to improve how future incidents are detected and handled. This process is key to continually enhancing the security measures in place, ensuring better preparedness for any future incidents.
